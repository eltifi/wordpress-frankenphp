; FrankenPHP Performance Configuration for WordPress
; Optimized for worker mode with persistent connections

; Disable functions that are unnecessary in worker mode
disable_functions = curl_multi_exec

; Worker mode settings
; Worker mode keeps PHP running, so we can be more aggressive with caching
default_charset = UTF-8
max_input_vars = 5000
max_input_time = 300

; Connection pooling for database and cache
mysql.allow_persistent = 1
mysql.max_persistent = -1
mysql.max_links = -1
mysqli.allow_persistent = 1
mysqli.max_persistent = -1
mysqli.max_links = -1

; Real-time capabilities
; Allow full-duplex communication for Server-Sent Events, WebSockets, etc.
default_socket_timeout = 60

; Session settings optimized for distributed cache (Redis)
session.cache_limiter = nocache
session.use_only_cookies = 1
session.cookie_httponly = 1
session.cookie_samesite = "Lax"

; File uploads
file_uploads = 1
upload_tmp_dir = /tmp
upload_max_filesize = 256M
post_max_size = 256M

; Limits
memory_limit = 512M
max_execution_time = 300
max_input_time = 300

; Warnings and errors
display_errors = 0
display_startup_errors = 0
log_errors = 1
error_log = /dev/stderr
log_errors_max_len = 1024

; OPcache Settings (Critical for performance)
; -------------------------------------------
opcache.enable = 1
opcache.enable_cli = 1
opcache.memory_consumption = 256
opcache.interned_strings_buffer = 64
opcache.max_accelerated_files = 50000
opcache.max_wasted_percentage = 15
; Revalidate timestamps: 0 for production (fastest), 1 for dev
; We use 1 here so you don't have to restart container on file edit, but tuned high
opcache.validate_timestamps = 1
opcache.revalidate_freq = 2
opcache.save_comments = 1
opcache.enable_file_override = 1
; JIT Compiler (PHP 8+)
opcache.jit_buffer_size = 128M
opcache.jit = tracing

